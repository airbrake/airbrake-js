(function(b,a,d){function c(f){f=f||{guess:true};var g=f.e||null,i=!!f.guess;var h=new c.implementation(),e=h.run(g);return(i)?h.guessAnonymousFunctions(e):e;}c.implementation=function(){};c.implementation.prototype={run:function(e,f){e=e||this.createException();f=f||this.mode(e);if(f==="other"){return this.other(arguments.callee);}else{return this[f](e);}},createException:function(){try{this.undef();}catch(f){return f;}},mode:function(f){if(f["arguments"]&&f.stack){return"chrome";}else{if(typeof f.message==="string"&&typeof b!=="undefined"&&b.opera){if(!f.stacktrace){return"opera9";}if(f.message.indexOf("\n")>-1&&f.message.split("\n").length>f.stacktrace.split("\n").length){return"opera9";}if(!f.stack){return"opera10a";}if(f.stacktrace.indexOf("called from line")<0){return"opera10b";}return"opera11";}else{if(f.stack){return"firefox";}}}return"other";},instrumentFunction:function(f,h,i){f=f||b;var e=f[h];f[h]=function g(){i.call(this,c().slice(4));return f[h]._instrumented.apply(this,arguments);};f[h]._instrumented=e;},deinstrumentFunction:function(e,f){if(e[f].constructor===Function&&e[f]._instrumented&&e[f]._instrumented.constructor===Function){e[f]=e[f]._instrumented;}},chrome:function(g){var f=(g.stack+"\n").replace(/^\S[^\(]+?[\n$]/gm,"").replace(/^\s+(at eval )?at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}()@$1$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}()@$1").split("\n");f.pop();return f;},firefox:function(f){return f.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^\(/gm,"{anonymous}(").split("\n");},opera11:function(l){var f="{anonymous}",m=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/;var o=l.stacktrace.split("\n"),p=[];for(var h=0,k=o.length;h<k;h+=2){var j=m.exec(o[h]);if(j){var n=j[4]+":"+j[1]+":"+j[2];var g=j[3]||"global code";g=g.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,f);p.push(g+"@"+n+" -- "+o[h+1].replace(/^\s+/,""));}}return p;},opera10b:function(m){var l=/^(.*)@(.+):(\d+)$/;var h=m.stacktrace.split("\n"),g=[];for(var k=0,f=h.length;k<f;k++){var j=l.exec(h[k]);if(j){var n=j[1]?(j[1]+"()"):"global code";g.push(n+"@"+j[2]+":"+j[3]);}}return g;},opera10a:function(l){var f="{anonymous}",m=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i;var n=l.stacktrace.split("\n"),o=[];for(var h=0,k=n.length;h<k;h+=2){var j=m.exec(n[h]);if(j){var g=j[3]||f;o.push(g+"()@"+j[2]+":"+j[1]+" -- "+n[h+1].replace(/^\s+/,""));}}return o;},opera9:function(n){var j="{anonymous}",m=/Line (\d+).*script (?:in )?(\S+)/i;var h=n.message.split("\n"),g=[];for(var l=2,f=h.length;l<f;l+=2){var k=m.exec(h[l]);if(k){g.push(j+"()@"+k[2]+":"+k[1]+" -- "+h[l+1].replace(/^\s+/,""));}}return g;},other:function(k){var f="{anonymous}",j=/function\s*([\w\-$]+)?\s*\(/i,e=[],h,g,i=10;while(k&&k["arguments"]&&e.length<i){h=j.test(k.toString())?RegExp.$1||f:f;g=Array.prototype.slice.call(k["arguments"]||[]);e[e.length]=h+"("+this.stringifyArguments(g)+")";k=k.caller;}return e;},stringifyArguments:function(g){var f=[];var j=Array.prototype.slice;for(var h=0;h<g.length;++h){var e=g[h];if(e===d){f[h]="undefined";}else{if(e===null){f[h]="null";}else{if(e.constructor){if(e.constructor===Array){if(e.length<3){f[h]="["+this.stringifyArguments(e)+"]";}else{f[h]="["+this.stringifyArguments(j.call(e,0,1))+"..."+this.stringifyArguments(j.call(e,-1))+"]";}}else{if(e.constructor===Object){f[h]="#object";}else{if(e.constructor===Function){f[h]="#function";}else{if(e.constructor===String){f[h]='"'+e+'"';}else{if(e.constructor===Number){f[h]=e;}}}}}}}}}return f.join(",");},sourceCache:{},ajax:function(f){var g=this.createXMLHTTPObject();if(g){try{g.open("GET",f,false);g.send(null);return g.responseText;}catch(h){}}return"";},createXMLHTTPObject:function(){var h,f=[function(){return new XMLHttpRequest();},function(){return new ActiveXObject("Msxml2.XMLHTTP");},function(){return new ActiveXObject("Msxml3.XMLHTTP");},function(){return new ActiveXObject("Microsoft.XMLHTTP");}];for(var g=0;g<f.length;g++){try{h=f[g]();this.createXMLHTTPObject=f[g];return h;}catch(j){}}},isSameDomain:function(e){return typeof location!=="undefined"&&e.indexOf(location.hostname)!==-1;},getSource:function(e){if(!(e in this.sourceCache)){this.sourceCache[e]=this.ajax(e).split("\n");}return this.sourceCache[e];},guessAnonymousFunctions:function(p){for(var l=0;l<p.length;++l){var k=/\{anonymous\}\(.*\)@(.*)/,q=/^(.*?)(?::(\d+))(?::(\d+))?(?: -- .+)?$/,f=p[l],g=k.exec(f);if(g){var j=q.exec(g[1]);if(j){var h=j[1],e=j[2],o=j[3]||0;if(h&&this.isSameDomain(h)&&e){var n=this.guessAnonymousFunction(h,e,o);p[l]=f.replace("{anonymous}",n);}}}}return p;},guessAnonymousFunction:function(h,j,f){var g;try{g=this.findFunctionName(this.getSource(h),j);}catch(i){g="getSource failed with url: "+h+", exception: "+i.toString();}return g;},findFunctionName:function(e,j){var l=/function\s+([^(]*?)\s*\(([^)]*)\)/;var p=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*function\b/;var n=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*(?:eval|new Function)\b/;var f="",q,o=Math.min(j,20),h,g;for(var k=0;k<o;++k){q=e[j-k-1];g=q.indexOf("//");if(g>=0){q=q.substr(0,g);}if(q){f=q+f;h=p.exec(f);if(h&&h[1]){return h[1];}h=l.exec(f);if(h&&h[1]){return h[1];}h=n.exec(f);if(h&&h[1]){return h[1];}}}return"(?)";}};(function(){var f='<?xml version="1.0" encoding="UTF-8"?><notice version="2.0"><api-key>{key}</api-key><notifier><name>airbrake_js</name><version>0.2.0</version><url>http://airbrake.io</url></notifier><error><class>{exception_class}</class><message>{exception_message}</message><backtrace>{backtrace_lines}</backtrace></error><request><url>{request_url}</url><component>{request_component}</component><action>{request_action}</action>{request}</request><server-environment><project-root>{project_root}</project-root><environment-name>{environment}</environment-name></server-environment></notice>',e,h;h={merge:(function(){function i(k,j,l){if(l.hasOwnProperty(k)){j[k]=l[k];}}return function(){var l=Array.prototype.slice.call(arguments),m,k,j={};while(m=l.shift()){for(k in m){i(k,j,m);}}return j;};})(),escape:function(i){return i.replace(/&/g,"&#38;").replace(/</g,"&#60;").replace(/>/g,"&#62;").replace(/'/g,"&#39;").replace(/"/g,"&#34;");},trim:function(i){return i.toString().replace(/^\s+/,"").replace(/\s+$/,"");},substitute:function(k,j,i){return k.replace(/{([\w_.-]+)}/g,function(l,m){return(m in j)?j[m]:(i?"":l);});}};e=b.Airbrake=b.Hoptoad={xmlData:{environment:"environment"},options:{host:"api.airbrake.io",errorDefaults:{},guessFunctionName:false},setEnvironment:function(i){this.xmlData.environment=i;},setKey:function(i){this.xmlData.key=i;},setHost:function(i){this.options.host=i;},setErrorDefaults:function(i){this.options.errorDefaults=i;},setGuessFunctionName:function(i){this.options.guessFunctionName=i;}};function g(){this.options=h.merge({},e.options);this.xmlData=h.merge(this.DEF_XML_DATA,e.xmlData);}g.prototype={constructor:g,VERSION:"0.2.0",ROOT:b.location.protocol+"//"+b.location.host,BACKTRACE_MATCHER:/^(.*)\@(.*)\:(\d+)$/,backtrace_filters:[/notifier\.js/],DEF_XML_DATA:{request:""},notify:function(k){var j=escape(this.generateXML(k)),i="//"+this.options.host+"/notifier_api/v2/notices?data="+j,l=a.createElement("iframe");l.style.display="none";l.src=i;l.onload=function(){setTimeout(function(){a.body.removeChild(l);},0);};a.body.appendChild(l);},generateXML:function(j){var q=this.xmlData,l,o,k,p,n=h.merge(this.options.errorDefaults,j),m=h.trim(h.escape(n.component||""));q.request_url=h.trim(h.escape((n.url||"")+location.hash));if(q.request_url||m){l=n["cgi-data"]||{};l.HTTP_USER_AGENT=navigator.userAgent;q.request+="<cgi-data>"+this.generateVariables(l)+"</cgi-data>";k=["params","session"];for(o=0;o<k.length;o++){p=k[o];if(n[p]){q.request+="<"+p+">"+this.generateVariables(n[p])+"</"+p+">";}}q.request_url=h.escape((n.url||"")+location.hash);q.request_action=h.escape(n.action||"");q.request_component=m;}q.project_root=this.ROOT;q.exception_class=h.escape(n.type||"Error");q.exception_message=h.escape(n.message||"Unknown error.");q.backtrace_lines=this.generateBacktrace(n).join("");return h.substitute(f,q,true);},generateBacktrace:function(k){var j=[],m,l,o,n;k=k||{};if(typeof k.stack!=="string"){try{(0)();}catch(p){k.stack=p.stack;}}n=this.getStackTrace(k);for(l=0;l<n.length;l++){o=n[l].match(this.BACKTRACE_MATCHER);if(o&&this.validBacktraceLine(n[l])){m=o[2].replace(this.ROOT,"[PROJECT_ROOT]");if(l===0&&o[2].match(a.location.href)){j.push('<line method="" file="internal: " number=""/>');}j.push('<line method="'+h.escape(o[1])+'" file="'+h.escape(m)+'" number="'+o[3]+'" />');}}return j;},getStackTrace:function(j){var k,l=c({e:j,guess:this.options.guessFunctionName});for(k=0;k<l.length;k++){if(l[k].match(/\:\d+$/)){continue;}if(l[k].indexOf("@")===-1){l[k]+="@unsupported.js";}l[k]+=":0";}return l;},validBacktraceLine:function(j){for(var k=0;k<this.backtrace_filters.length;k++){if(j.match(this.backtrace_filters[k])){return false;}}return true;},generateVariables:function(k){var j,i="";for(j in k){if(k.hasOwnProperty(j)){i+='<var key="'+h.escape(j)+'">'+h.escape(k[j])+"</var>";}}return i;}};b.onerror=function(k,j,i){setTimeout(function(){new g().notify({message:k,stack:"()@"+j+":"+i});},0);return true;};})();})(window,document);